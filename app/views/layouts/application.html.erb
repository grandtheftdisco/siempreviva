<!DOCTYPE html>
<html>
  <%= render partial: "layouts/public/head" %>

  <body>
    <header>
      <div class="mx-auto flex items-center mx-auto p-4 gap-5">
          
        <!-- Logo -->
        <div class="mr-auto pl-2 pt-2">
          <a href="<%= root_path %>" class="flex items-center space-x-3 rtl:space-x-reverse">
            <%= image_tag 'logo.png', class: 'h-30', alt: 'Logo' %>
          </a>
        </div>
      
        <!-- Navbar Links -->
        <div class="flex-1 flex pl-15" id="navbar-default">
          <ul class="flex flex-col p-5 md:p-0 mt-4 font-medium text-2xl gap-5 border border-gray-100 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-white">
            <li><%= link_to 'Products', products_path %></li>
            <li><%= link_to 'Our Farms', our_farms_path %></li> 
            <li><%= link_to 'Learn', learn_path %></li>
            <li><%= link_to 'Contact', contact_path %></li>
          </ul>
        </div>

        <!-- Search Section -->
        <div class="flex items-center space-x-2 px-10">
          <div id="searchbox" class="flex items-center justify-end p-0 m-0"></div>
          <div id="hits" class="flex justify-end"></div>
        </div>

        <!-- Right Side Icons -->
        <div class="flex items-center space-x-4">
          <!-- Cart Dropdown -->
          <button id="cartDropdownButton" data-dropdown-toggle="cartDropdown" class="relative inline-flex items-center p-2 text-sm font-medium text-center text-gray-600 hover:text-gray-900">
            <!-- Shopping Cart Icon -->
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119.993zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"></path>
            </svg>
            <!-- Cart Badge (positioned on top-right side) -->
            <span class="absolute -top-1 -right-1 bg-purple-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center"><%= @cart.cart_items.count %></span>
          </button>

          <!-- Dropdown Menu -->
          <div id="cartDropdown" class="z-10 hidden w-64 bg-white rounded-lg shadow-lg">
            <div class="p-4">
              <h3 class="font-semibold text-gray-900">Shopping Cart</h3>
            </div>
            <ul class="divide-y divide-gray-200">
            <% @cart.cart_items.each do |item| %>
              <li class="flex items-center p-4">
                <div class="ms-3">
                  <%= image_tag(item.image, class: "h-20 rounded-2xl") %>
                  <p class="text-sm font-medium text-gray-900"><%= item.name %></p>
                  <p class="text-sm text-gray-500"><%= to_dollars(item.price) %></p>
                </div>
              </li>
            <% end %>
            </ul>
            <div class="p-4 space-y-2">
              <a href="<%= cart_path %>" class="block w-full px-4 py-2 text-center text-white bg-blue-600 rounded-lg hover:bg-blue-700">View Cart</a>
              <a href="<%= new_checkout_path %>" class="block w-full px-4 py-2 text-center text-white bg-green-600 rounded-lg hover:bg-green-700">Checkout</a>
            </div>
          </div>

          <!-- Mobile Menu Button -->
          <button data-collapse-toggle="navbar-default" type="button" class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200">
            <span class="sr-only">Open main menu</span>
            <svg class="w-5 h-5" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
        </div>
        </div>
      </header>
    <main>
      <%= render partial: "layouts/public/flash_alert" %>
      <%= yield %>
    </main>
  </body>
</html>

<style>
 /* will refactor this into stylesheet and/or custom classes when i start on the front end*/
  .ais-SearchBox-submitIcon {
    width: 20px !important;
    height: 20px !important;
    margin-top: 0px;
    margin-left: 5px;
    padding: 0px;
  }

  .ais-SearchBox-input {
    background: lavender;
    border: 1px solid;
    border-radius: 1rem;
    padding: 0px;
  }

  .ais-SearchBox-submit {
    font-size: 1.125rem;
    background: transparent;
    padding: 0px;
    color: #d8b4fe;
  }

  .ais-SearchBox-submit:hover {
    color: #7c3aed;
  }
  
  .ais-SearchBox-form {
    padding: 0px;
    margin: 0px;
  }

  .ais-Hits {
    background: lavender;
    width: 200px;
    border-radius: 1rem;
    border: 1px solid;
    padding: 0px;
    margin-right: 0px;
  }

  .ais-Hits-item a {
    display: block;
    border-radius: 1rem;
    padding: 0px;
  }

  .ais-Hits-item a:hover {
    background: #e3c7ff;
    border-radius: 1rem;
  }

  .ais-Highlight-highlighted {
    background: #e3c7ff;
  }
</style>

<script>
  // Initialize the search client

  const { liteClient: algoliasearch } = window['algoliasearch/lite'];
  const searchClient = algoliasearch('<%= Rails.application.credentials.algolia[:application_id] %>',
                                     '<%= Rails.application.credentials.algolia[:search_api_key] %>');

  // Render the InstantSearch.js wrapper
  const search = instantsearch({
    indexName: 'products_index',
    searchClient,
    searchFunction(helper) {
      // only search if the query is not empty
      if (helper.state.query.trim() === '') {
        // hide hits container if query is empty
        document.querySelector('#hits').style.display = 'none';
        return;
      }
      // show hits container and search
      document.querySelector('#hits').style.display = '';
      helper.search();
    }
  });

  search.addWidgets([
    instantsearch.widgets.searchBox({
      container: '#searchbox'
    }),

    instantsearch.widgets.hits({
      container: '#hits',
      templates: {
        item(hit, { html, components }) {

          const url = `/products/${hit.objectId}`;

          return html`
            <a href="${url}" class="block hover:bg-purple-50 rounded-2xl p-2">
              <h2>
                ${components.Highlight({ attribute: 'name', hit })}
              </h2>
            </a>
          `;
        },
      },
    })
  ]);

  // hide hits on initial load
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelector('#hits').style.display = 'none';
  });

  search.start();

</script>