<!DOCTYPE html>
<html class="scroll-smooth">
  <%= render partial: "layouts/public/head" %>

  <body>
    <!-- Keep relative inline - breaks header layout if moved to CSS -->
    <header class="relative"
            data-controller="algolia-search"
            data-algolia-search-app-id-value="<%= Rails.application.credentials.algolia[:application_id] %>"
            data-algolia-search-search-key-value="<%= Rails.application.credentials.algolia[:search_api_key] %>">
      <div class="header-container">

        <!-- Logo -->
        <div class="logo-section">
          <a href="<%= root_path %>" class="logo-link">
            <%= image_tag 'logo.png', class: 'logo-image', alt: 'Logo' %>
          </a>
        </div>

        <!-- Navbar Links - Keep responsive utilities inline for proper mobile/desktop visibility toggle -->
        <div id="navbar-default"
             class="navbar-section hidden md:flex">
          <ul class="navbar-list">
            <li><%= link_to 'products', products_path, class: 'text-link' %></li>
            <li><%= link_to 'our farms', our_farms_path, class: 'text-link' %></li>
            <li><%= link_to 'learn', learn_path, class: 'text-link' %></li>
            <li><%= link_to 'contact', new_contact_form_path, class: 'text-link' %></li>
          </ul>
        </div>

        <!-- Desktop Search Section - Keep responsive utilities inline for proper mobile/desktop visibility toggle -->
        <div class="search-section hidden md:flex">
          <div class="search-inline">
            <div id="searchbox-desktop"
                 class="search-container"
                 data-algolia-search-target="searchboxDesktop">
            </div>
            <div id="hits-desktop"
                 class="search-results"
                 data-algolia-search-target="hitsDesktop">
            </div>
          </div>
        </div>

        <!-- Desktop Cart Section - Keep responsive utilities inline for proper mobile/desktop visibility toggle -->
        <div class="right-icons hidden md:flex"
             data-controller="dropdown">
          <!-- Cart Dropdown -->
          <button id="cartDropdownButton"
                  class="cart-button"
                  data-action="click->dropdown#toggle">
            <!-- Shopping Cart Icon -->
            <svg class="cart-icon"
                 fill="none"
                 stroke="currentColor"
                 stroke-width="2"
                 viewBox="0 0 24 24">
              <path stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119.993zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"/>
            </svg>
            <!-- Cart Badge -->
            <span class="cart-badge"><%= @cart.cart_items.count %></span>
          </button>

          <%= render 'shared/cart_dropdown' %>
        </div>

        <!-- Mobile Nav Items (Search + Right Icons) - Keep responsive utilities inline for proper mobile/desktop visibility toggle -->
        <div class="mobile-nav-items-container md:hidden">
          <!-- Search Icon + Dropdown wrapped for Stimulus (contents preserves flex layout) -->
          <div class="contents"
               data-controller="dropdown">
            <div class="search-section">
              <button id="searchToggleButton"
                      class="search-toggle-button"
                      data-action="click->dropdown#toggle">
                <svg class="search-icon"
                     fill="none"
                     stroke="currentColor"
                     stroke-width="2"
                     viewBox="0 0 24 24">
                  <path stroke-linecap="round"
                        stroke-linejoin="round"
                        d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"/>
                </svg>
              </button>
            </div>
            <!-- Search Dropdown (Mobile) -->
            <div id="searchDropdown"
                 class="search-dropdown"
                 data-dropdown-target="menu">
              <div id="searchbox"
                   class="search-container"
                   data-algolia-search-target="searchbox">
              </div>
              <div id="hits"
                   class="search-results"
                   data-algolia-search-target="hits">
              </div>
            </div>
          </div>

          <!-- Bag & Hamburger Menu Icons -->
          <div class="mobile-nav-right-icons">
            <!-- Hamburger Menu Button -->
            <button class="mobile-menu-button"
                    data-controller="collapse"
                    data-collapse-target-id-value="navbar-default"
                    data-action="click->collapse#toggle">
              <span class="sr-only">Open main menu</span>
              <svg class="mobile-menu-icon"
                   aria-hidden="true"
                   fill="none"
                   stroke="currentColor"
                   stroke-width="2"
                   viewBox="0 0 24 24">
                <path stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M4 6h16M4 12h16M4 18h16"/>
              </svg>
            </button>

            <!-- Wrapper for DropdownController's toggle of Cart Dropdown -->
            <div data-controller="dropdown">
              <!-- Mobile Cart Dropdown Button -->
              <button id="cartDropdownButtonMobile"
                      class="cart-button"
                      data-action="click->dropdown#toggle">
                <!-- Shopping Cart Icon -->
                <svg class="cart-icon"
                     fill="none"
                     stroke="currentColor"
                     stroke-width="2"
                     viewBox="0 0 24 24">
                  <path stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119.993zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"/>
                </svg>
                <!-- Cart Badge -->
                <span class="cart-badge"><%= @cart.cart_items.count %></span>
              </button>

              <%= render 'shared/cart_dropdown', dropdown_id: 'cartDropdownMobile' %>
            </div>
          </div>
        </div> <!-- End mobile-nav-items -->
      </div> <!-- End header-container -->
    </header>
    <main<%= ' class="has-flash-messages"'.html_safe if flash.any? %>>
      <%= render partial: "layouts/public/flash_alert" %>
      <%= yield %>
    </main>

    <footer class="site-footer">
      <div class="footer-inner-container">
        <div class="footer-content">
          <!-- Navigation Links -->
          <div class="footer-section">
            <h3 class="footer-section-title">Explore</h3>
            <ul class="footer-nav">
              <li><%= link_to 'Products', products_path, class: 'footer-link' %></li>
              <li><%= link_to 'Our Farms', our_farms_path, class: 'footer-link' %></li>
              <li><%= link_to 'Learn', learn_path, class: 'footer-link' %></li>
              <li><%= link_to 'Contact', new_contact_form_path, class: 'footer-link' %></li>
              <li><%= link_to 'Gallery', gallery_path, class: 'footer-link' %></li>
            </ul>
          </div>

          <!-- Social Links -->
          <div class="footer-section">
            <h3 class="footer-section-title">Follow Us</h3>
            <div class="footer-social-icons-container">
              <%= social_icon(:facebook, "https://facebook.com/siemprevivaoils") %>
              <%= social_icon(:instagram, "https://instagram.com/siemprevivaulja") %>
            </div>
          </div>
        </div>

        <!-- Copyright -->
        <div class="footer-bottom">
          <p class="footer-copyright">
            &copy; <%= Date.current.year %> Siempreviva. All rights reserved.
          </p>
        </div>
      </div>
    </footer>
  </body>
</html>
