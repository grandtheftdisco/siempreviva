<div class="cart-page-item">
  <!-- Product Image -->
  <div class="cart-item-image">
    <% if cart_item.image.present? %>
      <%= image_tag(cart_item.image, alt: cart_item.name, class: 'product-image') %>
    <% else %>
      <div class="image-placeholder"></div>
    <% end %>
  </div>
  
  <!-- Product Details -->
  <div class="cart-item-details">
    <div class="cart-item-header">
      <h3 class="product-name"><%= cart_item.name.titleize %></h3>
      
      <!-- Remove Button - Top Right -->
      <%= button_to cart_item_path(cart_item),
          method: :delete,
          class: 'cart-item-remove-button absolute top-1/2 right-0 -translate-y-1/2 z-10 inline-flex items-center justify-center',
          data: {
            confirm: 'Remove this item from your cart?'
          },
          title: 'Remove item',
          form_class: 'cart-item-remove-form' do %>
        <svg class="w-4 h-4 stroke-current" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      <% end %>
    </div>
    
    <p class="product-price"><%= to_dollars(cart_item.price) %></p>
    
    <!-- Quantity Controls - Mobile: collapsed by default, Desktop: always visible -->
    <div class="quantity-section" data-controller="quantity-toggle">
      <%= form_with model: cart_item, url: cart_item_path(cart_item), method: :patch, local: true, class: 'quantity-form' do |f| %>

        <!-- Mobile: Collapsed Badge (tap to expand) -->
        <div data-quantity-toggle-target="badge"
             data-action="click->quantity-toggle#toggle"
             class="md:hidden cursor-pointer inline-flex items-center gap-2 text-sm text-gray-600 hover:text-gray-800 transition-colors">
          <span class="font-medium">qty: <%= cart_item.quantity %></span>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
          </svg>
        </div>

        <!-- Mobile: Expanded Selector (hidden by default) + Desktop: Always visible -->
        <div data-quantity-toggle-target="selector" class="hidden md:block">
          <div class="quantity-row">
            <label class="quantity-label">quantity:</label>
            <div class="quantity-controls-group">
              <%= render 'shared/quantity_selector',
                        input_id: "cart-item-#{cart_item.id}-quantity",
                        initial_value: cart_item.quantity,
                        min_value: 1,
                        field_name: 'cart_item[quantity]' %>
              <%= f.submit 'update', class: 'quantity-update-btn' %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
